import{r as c,j as e}from"./index-BTLMSJlm.js";const S=({onSubmit:v,onCancel:p,leaveBalance:u})=>{const[t,o]=c.useState({leaveType:"",startDate:"",endDate:"",additionalManager:"",reason:""}),y=r=>{const n=document.getElementById(r);n&&(n.focus(),n.showPicker())},[s,x]=c.useState({}),[j,b]=c.useState(!1),[g,a]=c.useState({type:"",text:""}),[i,l]=c.useState("");c.useEffect(()=>{const r=new Date().toISOString().split("T")[0];o(n=>({...n,startDate:r,endDate:r}))},[]),c.useEffect(()=>{if(t.leaveType){const n={"Sick Leave":"Sick Leave (Paid)","Casual Leave":"Casual Leave (Paid)","Paid Leave":"Emergency Leave (Paid)","unPaid Leave":"Unpaid Leave","Paternity Leave":"Paternity Leave (Paid)"}[t.leaveType];n&&u[n]!==void 0?l(`${u[n]} days available`):l("Unlimited")}else l("")},[t.leaveType,u]);const d=r=>{const{name:n,value:f}=r.target;o(L=>({...L,[n]:f})),s[n]&&x(L=>{const N={...L};return delete N[n],N})},h=()=>{const r={};if(t.leaveType||(r.leaveType="Leave type is required"),t.startDate||(r.startDate="Start date is required"),t.endDate||(r.endDate="End date is required"),t.reason||(r.reason="Reason is required"),t.startDate&&t.endDate){const n=new Date(t.startDate),f=new Date(t.endDate);n>f&&(r.dateRange="End date cannot be before start date")}return x(r),Object.keys(r).length===0},m=async r=>{if(r.preventDefault(),!!h()){b(!0),a({type:"",text:""});try{await v(t)&&a({type:"success",text:"Leave application submitted successfully!"})}catch(n){a({type:"error",text:n.message||"Failed to submit leave application"})}finally{b(!1)}}},D=()=>{o({leaveType:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],additionalManager:"",reason:""}),x({}),a({type:"",text:""}),p&&p()};return e.jsx("div",{className:"mainbar-grid",children:e.jsx("div",{className:"pb-4",style:{overflow:"auto"},children:e.jsx("div",{className:"container-fluid py2",style:{color:"var(--primaryDashColorDark)"},children:e.jsxs("div",{children:[e.jsxs("div",{className:"my-auto mt-2",children:[e.jsx("div",{className:"d-flex align-items-center gap-2",children:e.jsx("h5",{className:"m-0 p-0 text-capitalize",style:{fontWeight:500,color:"var(--PrimaryColorDark)"},children:"Create Leave"})}),e.jsx("p",{className:"m-0",style:{color:"var(--Subtittles)"},children:"You can create a new leave request here."})]}),g.text&&e.jsx("div",{className:`alert ${g.type==="success"?"alert-success":"alert-danger"} mt-3`,children:g.text}),e.jsxs("form",{className:"py-4 rounded row",onSubmit:m,children:[e.jsxs("div",{className:"mb-3 col-12",children:[e.jsx("label",{htmlFor:"leaveType",className:"form-label",children:"Leave Type"}),e.jsxs("select",{className:`form-select rounded-2 bg-light text-dark border ${s.leaveType?"is-invalid":""}`,id:"leaveType",name:"leaveType",value:t.leaveType,onChange:d,required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"-- Select Leave Type --"}),e.jsx("option",{value:"Sick Leave",children:"Sick Leave"}),e.jsx("option",{value:"Casual Leave",children:"Casual Leave"}),e.jsx("option",{value:"Paid Leave",children:"Paid Leave"}),e.jsx("option",{value:"unPaid Leave",children:"UnPaid Leave"}),e.jsx("option",{value:"Paternity Leave",children:"Paternity Leave"})]}),s.leaveType&&e.jsx("div",{className:"invalid-feedback",children:s.leaveType})]}),e.jsxs("div",{className:"mb-3 col-12",children:[e.jsx("label",{htmlFor:"leaveCount",className:"form-label",children:"Available"}),e.jsx("div",{className:"rounded-2 w-100 text-dark border dark-placeholder",style:{width:"fit-content",position:"relative",background:"rgba(201, 34, 34, 0.118)"},children:e.jsx("input",{className:"form-control rounded-2 bg-light text-dark border dark-placeholder",id:"leaveCount",name:"leaveCount",readOnly:!0,disabled:!0,placeholder:t.leaveType?i:"Please select a leave type",value:t.leaveType?i:"",style:{opacity:1}})})]}),e.jsxs("div",{className:"mb-3 col-6",onClick:()=>y("startDate"),style:{cursor:"pointer"},children:[e.jsx("label",{htmlFor:"startDate",className:"form-label",children:"Start Date:"}),e.jsx("input",{type:"date",className:`form-control rounded-2 bg-light text-dark ${s.startDate?"is-invalid":""}`,id:"startDate",name:"startDate",min:new Date().toISOString().split("T")[0],required:!0,value:t.startDate,onChange:d}),s.startDate&&e.jsx("div",{className:"invalid-feedback",children:s.startDate})]}),e.jsxs("div",{className:"mb-3 col-6",onClick:()=>y("endDate"),style:{cursor:"pointer"},children:[e.jsx("label",{htmlFor:"endDate",className:"form-label",children:"End Date:"}),e.jsx("input",{type:"date",className:`form-control rounded-2 bg-light text-dark ${s.endDate?"is-invalid":""}`,id:"endDate",name:"endDate",min:t.startDate||new Date().toISOString().split("T")[0],value:t.endDate,onChange:d}),s.endDate&&e.jsx("div",{className:"invalid-feedback",children:s.endDate}),s.dateRange&&e.jsx("div",{className:"invalid-feedback d-block",children:s.dateRange})]}),e.jsxs("div",{className:"mb-3 col-12 col-md-6",children:[e.jsx("label",{htmlFor:"manager",className:"form-label",children:"Reporting Manager:"}),e.jsx("input",{className:"form-control rounded-2 bg-light text-dark border-0",id:"manager",name:"manager",disabled:!0,placeholder:"demo.manager@munc.in",value:"demo.manager@munc.in"})]}),e.jsxs("div",{className:"mb-3 col-12 col-md-6",children:[e.jsx("label",{htmlFor:"hr",className:"form-label",children:"Reporting HR:"}),e.jsx("input",{className:"form-control rounded-2 bg-light text-dark border-0",id:"hr",name:"hr",disabled:!0,placeholder:"demo.hr@munc.in",value:"demo.hr@munc.in"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"additionalManager",className:"form-label",children:"Additional Manager:"}),e.jsxs("select",{className:"form-select rounded-2 bg-light text-dark border dark-placeholder",id:"additionalManager",name:"additionalManager",value:t.additionalManager,onChange:d,children:[e.jsx("option",{value:"",disabled:!0,children:"-- Select Additional Manager --"}),e.jsx("option",{value:"demo.admin@munc.in",children:"demo.admin@munc.in"}),e.jsx("option",{value:"demoemp2@munc.in",children:"demoemp2@munc.in"}),e.jsx("option",{value:"deepak@gmail.com",children:"deepak@gmail.com"}),e.jsx("option",{value:"sachin@gmail.com",children:"sachin@gmail.com"}),e.jsx("option",{value:"aloke@gmail.com",children:"aloke@gmail.com"}),e.jsx("option",{value:"sachin12@gmail.com",children:"sachin12@gmail.com"})]})]}),e.jsxs("div",{className:"mb-3",style:{position:"relative"},children:[e.jsx("label",{htmlFor:"reason",className:"form-label",children:"Reason:"}),e.jsx("textarea",{className:`form-control rounded-2 bg-light text-dark border dark-placeholder ${s.reason?"is-invalid":""}`,id:"reason",name:"reason",maxLength:"100",required:!0,placeholder:"Please mention the reason for leave",value:t.reason,onChange:d}),e.jsxs("span",{style:{position:"absolute",bottom:"0.2rem",right:"2rem"},children:[100-t.reason.length," characters"]}),s.reason&&e.jsx("div",{className:"invalid-feedback",children:s.reason})]}),e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:j,children:j?"Submitting...":"Submit"}),e.jsx("button",{type:"reset",className:"btn btn-danger",onClick:D,disabled:j,style:{color:"white"},children:"Cancel"})]})]})]})})})})},P=()=>{const[v,p]=c.useState(!1),[u,t]=c.useState({"Casual Leave (Paid)":12,"Sick Leave (Paid)":10,"Emergency Leave (Paid)":5,"Unpaid Leave":0}),[o,y]=c.useState([{id:1,from:"2025-04-10",to:"2025-04-12",type:"Sick Leave (Paid)",reason:"Fever",status:"Approved",appliedOn:"2025-04-08",updatedBy:"HR Manager"},{id:2,from:"2025-03-28",to:"2025-03-30",type:"Casual Leave (Paid)",reason:"Family Function",status:"Pending",appliedOn:"2025-03-25",updatedBy:""},{id:3,from:"2025-02-14",to:"2025-02-14",type:"Emergency Leave (Paid)",reason:"Urgent work",status:"Rejected",appliedOn:"2025-02-13",updatedBy:"HR Manager"}]),s=a=>{if(!a)return"N/A";const i=new Date(a),l=i.getDate(),d=i.toLocaleString("default",{month:"short"}),h=i.getFullYear();return`${l+(l%10===1&&l!==11?"st":l%10===2&&l!==12?"nd":l%10===3&&l!==13?"rd":"th")}, ${d}, ${h}`},x=(a,i)=>{const l=new Date(a),d=new Date(i),h=Math.abs(d-l);return Math.ceil(h/(1e3*60*60*24))+1},j={"Sick Leave":"Sick Leave (Paid)","Casual Leave":"Casual Leave (Paid)","Paid Leave":"Emergency Leave (Paid)","unPaid Leave":"Unpaid Leave","Paternity Leave":"Paternity Leave (Paid)"},b=async a=>{const i=x(a.startDate,a.endDate),l=j[a.leaveType];try{const d=await fetch("http://localhost:5000/apply-leave",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:"6640fc93530c32158b8e3f4a",leaveType:l,from:a.startDate,to:a.endDate,reason:a.reason})});if(!d.ok){const m=await d.json();throw new Error(m.error||"Failed to apply leave")}const h={id:Date.now(),type:l,from:a.startDate,to:a.endDate,reason:a.reason,days:i,appliedOn:new Date().toISOString().split("T")[0],status:"Pending",updatedBy:""};return y(m=>[h,...m]),l!=="Unpaid Leave"&&t(m=>({...m,[l]:m[l]-i})),alert("✅ Leave applied successfully!"),p(!1),!0}catch(d){return console.error("Leave submission error:",d),alert(`❌ ${d.message}`),!1}},g=a=>{const i={Approved:"approved",Pending:"pending",Rejected:"rejected"};return e.jsx("span",{className:`badge ${i[a]}`,children:a})};return e.jsxs("div",{className:"leave-container",children:[e.jsxs("div",{className:"leave-header",children:[e.jsx("h1",{children:"Leave Management"}),e.jsx("button",{className:`toggle-btn ${v?"cancel":"apply"}`,onClick:()=>p(!v),children:v?"✕ Cancel":"➕ Apply for Leave"})]}),v&&e.jsx(S,{onSubmit:b,onCancel:()=>p(!1),leaveBalance:u}),e.jsxs("div",{className:"leave-balance-card",children:[e.jsx("h3",{children:"Your Leave Balance"}),e.jsx("div",{className:"balance-grid",children:Object.entries(u).map(([a,i])=>e.jsxs("div",{className:"balance-item",children:[e.jsx("div",{className:"balance-type",children:a}),e.jsx("div",{className:"balance-days",children:a==="Unpaid Leave"?"Unlimited":`${i} days`})]},a))})]}),e.jsxs("div",{className:"leave-history-card",children:[e.jsxs("div",{className:"history-header",children:[e.jsx("h3",{children:"Leave History"}),e.jsxs("div",{className:"history-stats",children:[e.jsxs("span",{children:["Total: ",o.length]}),e.jsxs("span",{children:["Approved: ",o.filter(a=>a.status==="Approved").length]}),e.jsxs("span",{children:["Pending: ",o.filter(a=>a.status==="Pending").length]}),e.jsxs("span",{children:["Rejected: ",o.filter(a=>a.status==="Rejected").length]})]})]}),o.length===0?e.jsx("div",{className:"no-history",children:"No leave history found"}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"leave-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Applied On"}),e.jsx("th",{children:"Leave Type"}),e.jsx("th",{children:"From"}),e.jsx("th",{children:"To"}),e.jsx("th",{children:"Days"}),e.jsx("th",{children:"Reason"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Updated By"})]})}),e.jsx("tbody",{children:o.map(a=>e.jsxs("tr",{className:`status-${a.status.toLowerCase()}`,children:[e.jsx("td",{children:s(a.appliedOn)}),e.jsx("td",{children:a.type}),e.jsx("td",{children:s(a.from)}),e.jsx("td",{children:s(a.to)}),e.jsx("td",{children:x(a.from,a.to)}),e.jsx("td",{className:"reason-cell",children:a.reason}),e.jsx("td",{children:g(a.status)}),e.jsx("td",{children:a.updatedBy||"-"})]},a.id))})]})})]})]})};export{P as default};
